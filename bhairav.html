<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Raag Bhairav</title>
    <meta name="description" content="Interactive scales of Indian music" />
    <!-- TODO -->
    <!-- <link rel="icon" href="/icon.png" type="image/png"> -->
    <style>
      :root {
        --mr-c-bg: oklch(49.35% 0.025 53.84);
        --mr-c-text-1: oklch(98% 0 0);
        --mr-c-text-2: oklch(84.24% 0.006 43.32);
        --mr-c-accent-1: oklch(100% 0 0);
      }

      @media (prefers-color-scheme: dark) {
        :root {
          --mr-c-bg: oklch(25% 0.05 83.84);
          --mr-c-text-1: oklch(94% 0 0);
          --mr-c-text-2: oklch(75.15% 0.013 86.85);
          --mr-c-accent-1: oklch(98% 0 0);
        }
      }

      body {
        background-color: var(--mr-c-bg);
        color: var(--mr-c-text-1);
        font-family: system-ui, sans-serif;
        font-size: 22px;
        display: grid;
        grid-template-columns: 1fr min(31em, 100%) 5fr;
      }

      main,
      footer {
        /* A width limited column positioned slightly towards the left */
        grid-column: 2/3;
        padding-inline: 1rem;
      }

      footer {
        margin-block: 3rem;
        a {
          color: var(--mr-c-text-2);
          text-decoration: none;
        }
      }

      .name {
        font-family: serif;
        font-style: italic;
        font-size: larger;

        h1 {
          margin-block-end: 0.1em;
        }
      }

      .muted {
        color: var(--mr-c-text-2);
      }

      div.note,
      .dot {
        background-color: var(--mr-c-text-2);
        opacity: 0.2;
      }

      button.note {
        border: 0;
        cursor: pointer;
        background-color: var(--mr-c-text-2);
      }

      button.note:hover {
        background-color: var(--mr-c-accent-1);
      }

      button.note[data-playing] {
        background-color: var(--mr-c-accent-1);
      }

      button.note[data-root] {
        background-color: darkkhaki;
      }

      .ladder {
        box-sizing: border-box;
        min-height: 80svh;
        display: flex;
        flex-direction: column;
        align-items: end;
        gap: 4px;
        justify-content: space-evenly;
      }

      .ladder .note {
        width: 50%;
        /* Don't let anything shrink */
        flex-shrink: 0;
        /* Give all the items a fixed height */
        flex-basis: 12px;
        border-radius: 4px;
        margin-inline-end: calc(8px * (13 - var(--x)));
      }

      .fretboard .string,
      .fretboard .marks {
        display: flex;
        justify-content: center;
        margin-block: 12px;
        gap: 12px;
      }

      .fretboard .note,
      .fretboard .marks > div {
        flex-basis: 50px;
        height: 12px;
        border-radius: 3px;
      }

      .dot {
        width: 8px;
        height: 8px;
        margin: auto;
        border-radius: 4px;
      }
    </style>
    <script type="module">
      import { Synth } from "./pages/raag/synth.ts";

      const synth = new Synth();
      let canAutoPlay = false;

      window.addEventListener("click", () => {
        synth.init(); /* if needed */
        canAutoPlay = true;
      });

      const play = (button) => {
        const offset = parseInt(button.getAttribute("data-offset"));
        button.setAttribute("data-playing", true);
        synth.play({ note: 69 + offset }, () => {
          button.removeAttribute("data-playing");
        });
      };

      const notes = document.querySelectorAll(".ladder > button");
      for (const note of notes) {
        if (!note.disabled) {
          note.addEventListener("click", (e) => play(e.target));
          note.addEventListener("pointerenter", (e) => {
            if (canAutoPlay) play(e.target);
          });
        }
      }
    </script>
  </head>
  <body>
    <main>
      <div class="name">
        <h1><span class="muted">ra'g</span> bhairav</h1>
        <span class="muted">राग</span> भैरव
      </div>
      <section>
        <div class="ladder">
          <!-- bhairav notes: [0, 1, 4, 5, 7, 8, 11] -->
          <button class="note" data-offset="12" style="--x: 12"></button>
          <button class="note" data-offset="11" style="--x: 11"></button>
          <div class="note" data-offset="10" style="--x: 10"></div>
          <div class="note" data-offset="9" style="--x: 9"></div>
          <button class="note" data-offset="8" style="--x: 8"></button>
          <button class="note" data-offset="7" style="--x: 7"></button>
          <div class="note" data-offset="6" style="--x: 6"></div>
          <button class="note" data-offset="5" style="--x: 5"></button>
          <button class="note" data-offset="4" style="--x: 4"></button>
          <div class="note" data-offset="3" style="--x: 3"></div>
          <div class="note" data-offset="2" style="--x: 2"></div>
          <button class="note" data-offset="1" style="--x: 1"></button>
          <button class="note" data-offset="0" style="--x: 0"></button>
        </div>
        <p>
          Raags are like scales (<i>not really</i>, but it's a good first
          approximation)
        </p>
        <p>
          Above you can see the distance between notes on raag Bhairav – Hover
          on them to hear how they sound (tap once to enable audio)
        </p>
      </section>
      <section>
        <div class="fretboard">
          <!-- bhairav notes: [0, 1, 4, 5, 7, 8, 11] -->
          <div class="string">
            <div class="note"></div>
            <div class="note"></div>
            <div class="note"></div>
            <div class="note"></div>
            <div class="note"></div>
            <div class="note"></div>
            <div class="note"></div>
            <div class="note"></div>
          </div>
          <div class="string">
            <div class="note"></div>
            <div class="note"></div>
            <div class="note"></div>
            <div class="note"></div>
            <div class="note"></div>
            <div class="note"></div>
            <div class="note"></div>
            <div class="note"></div>
          </div>
          <div class="string">
            <div class="note"></div>
            <div class="note"></div>
            <div class="note"></div>
            <div class="note"></div>
            <div class="note"></div>
            <div class="note"></div>
            <div class="note"></div>
            <div class="note"></div>
          </div>
          <div class="string">
            <div class="note"></div>
            <div class="note"></div>
            <div class="note"></div>
            <button class="note" data-offset="11"></button>
            <div class="note"></div>
            <div class="note"></div>
            <div class="note"></div>
            <div class="note"></div>
          </div>
          <div class="string">
            <div class="note"></div>
            <div class="note"></div>
            <button class="note" data-offset="5"></button>
            <div class="note"></div>
            <button class="note" data-offset="7"></button>
            <button class="note" data-offset="8"></button>
            <div class="note"></div>
            <div class="note"></div>
          </div>
          <div class="string">
            <div class="note"></div>
            <div class="note"></div>
            <button class="note" data-offset="0" data-root></button>
            <button class="note" data-offset="1"></button>
            <div class="note"></div>
            <div class="note"></div>
            <button class="note" data-offset="4"></button>
            <div class="note"></div>
          </div>
          <div class="marks">
            <div><div class="dot"></div></div>
            <div></div>
            <div><div class="dot"></div></div>
            <div></div>
            <div><div class="dot"></div></div>
            <div></div>
            <div><div class="dot"></div></div>
            <div></div>
          </div>
        </div>
      </section>
    </main>
    <footer>
      <a href="/">/</a>
    </footer>
  </body>
</html>
