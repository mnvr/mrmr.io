---
title: Making music in Javascript
date: 2024-01-25
unlisted: true
description: Learning elementary DSP by implementing it in JavaScript
layout: code
---

import * as C from "./components";

<C.Container>

<C.Section>

### First sound

<C.Box>

<C.Explanation>

Let's make a sound in JavaScript. Browsers implement WebAudio. WebAudio provides
two ways of making sounds:

1. The simpler way is by connecting a collection of primitive nodes that
   WebAudio provides - these are things like oscillators, barebones IIR filters
   etc.

2. The more advanced way is to use a thing called "AudioWorklet", wherein we
   write code to compute the individual samples themselves.

Let's make a sound using the first method.

</C.Explanation>

```
const ctx = new AudioContext()
ctx.resume()

const osc = new OscillatorNode(ctx)
// Reduce volume, the default is too loud!
const mix = new GainNode(ctx, { gain: 0.1 })
osc.connect(mix).connect(ctx.destination)
osc.start()
```

</C.Box>

<C.SoundFirst />

</C.Section>

<C.Section>

### Beep

<C.Box>

<C.Explanation>

When you press the button above, you might've noticed a glitch when the sound
started.

Our ears are more sensitive than you might consciously imagine. When we start
the sound above, it immediately starts playing, and this sudden movement is
heard as a rather ugly pop. Ditto when the sound immediately stops.

Real life sounds don't behave like that. They have an _attack_ phase, when the
sound slowly rises from nothing (say if you hit a drum with a stick). And there
is a _release_ phase where the sound slowly dies away instead of suddenly
stopping.

Let's add them to our sound. And also move it to a function.

</C.Explanation>

```
const beep = (duration) => {
  const attack = 0.001 // Attack of 1 ms
  const release = 0.1  // Release of 100 ms
  const t = ctx.currentTime

  const osc = new OscillatorNode(ctx)
  const env = new GainNode(ctx, { gain: 1 })
  env.gain.setValueCurveAtTime(
    [0, 1], t, attack)
  env.gain.setTargetAtTime(
    0, t + attack + duration, release / 5)
  const mix = new GainNode(ctx, { gain: 0.1 })
  osc.connect(env)
     .connect(mix).connect(ctx.destination)
  osc.start()
  osc.stop(t + attack + duration + release)
}
```

</C.Box>

<C.SoundBeep />

</C.Section>

<C.Section>

### Beeps

<C.Box>

<C.Explanation>

Instead of clicking the button ourselves, let us ask the computer to click it
for us.

In music, a second is like an eternity. Events in music happen at the time scale
of tens of milliseconds, and there are a _thousand_ milliseconds in a second.

Events in music are called notes. We can easily hear around 16 of them in a
second.

</C.Explanation>

```
setInterval(() => {
   beep(0.05);
}, 200);
```

</C.Box>

<C.SoundBeeps />

</C.Section>

</C.Container>
